<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escape Game - Devinettes</title>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Lobster', cursive, system-ui, sans-serif;
      color: white;
      overflow-x: hidden;
      font-size: 16px;
      transition: background 0.5s ease-in-out;
    }

    .theme-classic {
      background: url('https://www.transparenttextures.com/patterns/stardust.png') repeat black;
    }

    .theme-disney {
      background: url('https://www.transparenttextures.com/patterns/stardust.png') repeat rgb(64, 2, 100);
    }

    .screen {
      min-height: 100vh;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 5vw;
      max-width: 600px;
      margin: auto;
      text-align: center;
    }

    .active {
      display: flex !important;
    }

    h1 {
      font-size: clamp(24px, 6vw, 36px);
      margin-bottom: 1em;
    }

    p, select {
      max-width: 90%;
      font-size: clamp(14px, 4.5vw, 20px);
      margin-bottom: 1.5em;
    }

    button, input, select {
      font-size: clamp(16px, 4.5vw, 22px);
      padding: 0.6em 1.2em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 0.5em;
    }

    .step-image {
      width: 80%;
      max-width: 150px;
      height: auto;
      border-radius: 10px;
      margin-bottom: 1em;
      object-fit: cover;
    }

    .key {
      width: 60px;
      display: none;
      margin-top: 10px;
      animation: fadeIn 1s ease;
    }

    .show {
      display: inline-block !important;
    }

    #darkness {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: radial-gradient(circle at 50% 50%, transparent 100px, rgba(0,0,0,0.95) 200px);
      transition: background 0.2s ease-out;
      z-index: 5;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.5); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="theme-classic">

<!-- √âcran de s√©lection -->
<div id="menu" class="screen active">
    <h1>üîê Bienvenue dans l‚ÄôEscape Game Virtuel</h1>
    <p>
        Tu es enferm√© dans un univers myst√©rieux, plong√© dans l‚Äôobscurit√©... Seule une lampe torche suit tes mouvements üïØÔ∏è.<br><br>
        Pour t‚Äôen √©chapper, tu devras r√©soudre
      <strong>3 √©nigmes</strong> choisies au hasard.<br><br>
      Seras-tu assez rapide et malin pour retrouver la libert√© avant la fin du temps imparti ? üïí
    </p>
    <p>
      Choisis ton aventure :
    </p>
    <select id="choice">
      <option value="1">üß† Devinettes classiques (logique & r√©flexion)</option>
      <option value="2">‚ú® Devinettes Disney (magie & souvenirs d‚Äôenfance)</option>
    </select>
  <button onclick="handleSelection()">Valider</button>
</div>

<!-- Intro classique -->
<div id="intro" class="screen">
  <h1>√âvasion Nocturne</h1>
  <p>Tu te r√©veilles dans une pi√®ce obscure. Trois √©nigmes al√©atoires gardent la sortie. Tu as 10 minutes pour t‚Äô√©chapper...</p>
  <button onclick="startGame()">Commencer</button>
</div>

<!-- Intro Disney -->
<div id="introDisney" class="screen">
  <h1>‚ú® L'√âvasion Enchant√©e ‚ú®</h1>
  <p>Bienvenue dans un monde f√©erique... Trois √©nigmes Disney prot√®gent la sortie ! Tu as 10 minutes pour t‚Äô√©chapper du royaume enchant√© !</p>
  <button onclick="startGameDisney()">üåü Commencer l'aventure</button>
</div>

<!-- Jeu classique -->
<div id="game" class="screen">
  <h2>Escape Game : Devinettes</h2>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  <div id="timer">‚è±Ô∏è Temps restant : 10:00</div>
  <img id="stepImage" class="step-image" src="" alt="Image √©nigme">
  <div id="stepText"></div>
  <input type="text" id="answerInput" placeholder="Ta r√©ponse ici">
  <button id="validateBtn" onclick="checkAnswer()">Valider</button>
  <div id="message"></div>
  <img id="keyImage" class="key" src="https://cdn-icons-png.flaticon.com/512/2721/2721260.png" alt="Cl√©">
</div>

<!-- Jeu Disney -->
<div id="gameDisney" class="screen">
  <h2>Escape Game : Devinettes Disney</h2>
  <div id="livesDisney">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  <div id="timerDisney">‚è±Ô∏è Temps restant : 10:00</div>
  <img id="stepImageDisney" class="step-image" src="" alt="Image √©nigme">
  <div id="stepTextDisney"></div>
  <input type="text" id="answerInputDisney" placeholder="Ta r√©ponse ici">
  <button id="validateBtnDisney" onclick="checkAnswerDisney()">Valider</button>
  <div id="messageDisney"></div>
  <img id="keyImageDisney" class="key" src="https://cdn-icons-png.flaticon.com/512/2721/2721260.png" alt="Cl√©">
</div>

<!-- Sons -->
<div id="darkness"></div>
<audio id="successSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d51d4d1cd5.mp3" preload="auto"></audio>
<audio id="errorSound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_3f7b5dc872.mp3" preload="auto"></audio>
<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/30/audio_6c02fefee4.mp3" autoplay loop preload="auto"></audio>

<script>
// ------- UTILS -------
function normalize(str) {
  return str.toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-zA-Z0-9\s]/g, "")
    .replace(/\b(le|la|un|une|des|de|du|les|et|en)\b/g, "")
    .replace(/\s+/g, " ")
    .trim();
}

function pickRandomItems(array, count) {
  const copy = [...array];
  const result = [];
  for (let i = 0; i < count; i++) {
    const index = Math.floor(Math.random() * copy.length);
    result.push(copy.splice(index, 1)[0]);
  }
  return result;
}

function handleSelection() {
  const val = document.getElementById("choice").value;
  document.getElementById("menu").classList.remove("active");
  if (val === "1") {
    document.body.className = "theme-classic";
    document.getElementById("intro").classList.add("active");
  } else {
    document.body.className = "theme-disney";
    document.getElementById("introDisney").classList.add("active");
  }
}
document.addEventListener("mousemove", e => {
  if (!document.getElementById("menu").classList.contains("active")) {
    darkness.style.background = `radial-gradient(circle at ${e.clientX}px ${e.clientY}px, transparent 100px, rgba(0,0,0,0.95) 200px)`;
  } else {
    darkness.style.background = "none"; // pas d'effet
  }
});

document.addEventListener("touchmove", e => {
  if (!document.getElementById("menu").classList.contains("active")) {
    const t = e.touches[0];
    darkness.style.background = `radial-gradient(circle at ${t.clientX}px ${t.clientY}px, transparent 100px, rgba(0,0,0,0.95) 200px)`;
  } else {
    darkness.style.background = "none"; // pas d'effet
  }
});

function enableGyroscopeTorch() {
  if (typeof DeviceOrientationEvent !== "undefined" && typeof DeviceOrientationEvent.requestPermission === "function") {
    DeviceOrientationEvent.requestPermission().then(state => {
      if (state === "granted") window.addEventListener("deviceorientation", handleGyroTorch);
    }).catch(console.error);
  } else {
    window.addEventListener("deviceorientation", handleGyroTorch);
  }
}
function handleGyroTorch(e) {
  const x = window.innerWidth / 2 + (e.gamma || 0) * 10;
  const y = window.innerHeight / 2 + (e.beta || 0) * 10;
  darkness.style.background = `radial-gradient(circle at ${x}px ${y}px, transparent 100px, rgba(0,0,0,0.95) 200px)`;
}

// ------- CLASSIQUE -------
const steps1 = [
  {
    question: "üîí Le double de 17 te lib√©rera.",
    answer: "34",
    synonyms: ["trente-quatre", "trent-quatre", "trente quatre", "34."],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üå´Ô∏è Je disparais quand on me nomme‚Ä¶",
    answer: "silence",
    synonyms: ["le silence", "absence de bruit", "silance", "silense", "sileence", "le bruit", "bruit"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üß† Plus tu en prends, plus tu laisses derri√®re toi.",
    answer: "pas",
    synonyms: ["traces", "empreintes", "trace", "pas de pas", "pas "],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üï≥Ô∏è Plus j‚Äôen ai, plus je deviens l√©ger. Qui suis-je ?",
    answer: "fromage",
    synonyms: ["gruy√®re", "froamage", "frommage", "formage", "fromage trou√©"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üï∞Ô∏è Je n‚Äôai pas de bouche, mais je peux r√©pondre √† toutes les questions.",
    answer: "livre",
    synonyms: ["encyclop√©die", "livres", "livr", "bouquin", "bouquain", "boukin", "dictionnaire"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üåû Je suis l√† tous les jours, mais on ne me voit jamais la nuit.",
    answer: "soleil",
    synonyms: ["astre du jour", "soleille", "solei", "solay", "solail"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üé© Je commence la nuit et je finis le matin, mais je ne suis ni un r√™ve ni un cauchemar.",
    answer: "sommeil",
    synonyms: ["dormir", "nuit", "sommeille", "sommeil profond", "sommei", "sommeille"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üî¢ Si tu me dis mon nom, je ne suis plus moi. Qui suis-je ?",
    answer: "secret",
    synonyms: ["confidence", "chose cach√©e", "secr√©", "sekret", "secr√®", "secre", "secret "],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üö™ Je suis toujours devant toi, mais tu ne peux jamais m‚Äôatteindre. Qui suis-je ?",
    answer: "avenir",
    synonyms: ["futur", "lavenir", "avenir ", "l'avenir", "av√©nir", "futtur"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "ü™û Je r√©fl√©chis sans penser. Qui suis-je ?",
    answer: "miroir",
    synonyms: ["glace", "miroire", "mirroir", "mirwa", "miroire magique", "le miroir"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  }
]
;
let steps1Selected = [], current1 = 0, lives1 = 3, time1 = 600, timer1;

function startGame() {
  document.getElementById("intro").classList.remove("active");
  document.getElementById("game").classList.add("active");
  enableGyroscopeTorch();
  document.getElementById("bgMusic").volume = 0.3;
  current1 = 0; lives1 = 3; time1 = 600;
  document.getElementById("lives").textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
  steps1Selected = pickRandomItems(steps1, 3);
  showStep1();
  timer1 = setInterval(() => {
    time1--;
    if (time1 <= 0) endGame1(false, "‚õî Temps √©coul√© !");
    else {
      const m = Math.floor(time1 / 60), s = time1 % 60;
      document.getElementById("timer").textContent = `‚è±Ô∏è Temps restant : ${m}:${s < 10 ? '0' : ''}${s}`;
    }
  }, 1000);
}
function showStep1() {
  document.getElementById("stepText").textContent = steps1Selected[current1].question;
  document.getElementById("stepImage").src = steps1Selected[current1].image;
  document.getElementById("answerInput").value = '';
  document.getElementById("keyImage").classList.remove("show");
  document.getElementById("message").textContent = '';
}
function checkAnswer() {
  const input = normalize(document.getElementById("answerInput").value);
  const valid = [steps1Selected[current1].answer, ...steps1Selected[current1].synonyms].some(a => input.includes(normalize(a)));
  if (valid) {
    successSound.play();
    document.getElementById("keyImage").classList.add("show");
    setTimeout(() => {
      current1++;
      current1 < steps1Selected.length ? showStep1() : endGame1(true);
    }, 1500);
  } else {
    errorSound.play();
    lives1--;
    document.getElementById("lives").textContent = "‚ù§Ô∏è".repeat(lives1) + "üñ§".repeat(3 - lives1);
    document.getElementById("message").textContent = "‚ùå Mauvaise r√©ponse.";
    if (lives1 <= 0) endGame1(false, "üíÄ Tu as perdu !");
  }
}
function endGame1(success, msg = "") {
  clearInterval(timer1);
  document.getElementById("stepText").textContent = success ? "üéâ Bravo !" : msg;
  document.getElementById("answerInput").style.display = "none";
  document.getElementById("validateBtn").style.display = "none";
  document.getElementById("lives").textContent = "";
  const btn = document.createElement("button");
  btn.textContent = "üîÅ Rejouer";
  btn.onclick = () => location.reload();
  document.getElementById("game").appendChild(btn);
}

// ------- DISNEY -------
const steps2 = [[
  {
    question: "üßû Qui vit dans une lampe magique ?",
    answer: "g√©nie",
    synonyms: ["djinn", "genie", "g√©nis", "jenie", "jeanie", "jinni", "le g√©nie", "le djinn"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "‚ùÑÔ∏è Je viens d'Arendelle et j‚Äôai des pouvoirs de glace.",
    answer: "elsa",
    synonyms: ["reine des neiges", "elza", "elsah", "elsaa", "la reine des neiges", "elssa", "aelsa"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "ü¶Å Mon p√®re est Mufasa...",
    answer: "simba",
    synonyms: ["lion", "simbaa", "simbah", "le lion", "simbba", "symba"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üê≠ Je suis la c√©l√®bre souris de Disney.",
    answer: "mickey",
    synonyms: ["mickey mouse", "mickey maus", "miky", "mick√©", "miki", "micki", "la souris", "mickei"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üê† Je suis un petit poisson clown perdu dans l'oc√©an.",
    answer: "nemo",
    synonyms: ["poisson clown", "nemmo", "n√©mo", "n√©mo le poisson", "memo", "le poisson", "nemo "],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üßö Je suis une petite f√©e amie de Peter Pan.",
    answer: "clochette",
    synonyms: ["f√©e clochette", "tinkerbell", "clochet", "clochet", "clochete", "f√©e", "clochette la f√©e", "tink"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üèπ Je suis une princesse rousse qui tire √† l‚Äôarc.",
    answer: "merida",
    synonyms: ["rebelle", "m√©rida", "meridda", "meridah", "la rousse", "princesse rebelle"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üïØÔ∏è Je suis un chandelier qui chante dans 'La Belle et la B√™te'.",
    answer: "lumi√®re",
    synonyms: ["cand√©labre", "lumiere", "lumi√©r", "le chandelier", "lumi√®r", "candelabre", "le bougeoir", "le luminaire"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üöó Je suis une voiture rouge de course dans 'Cars'.",
    answer: "flash",
    synonyms: ["flash mcqueen", "mcqueen", "flash macouine", "flash makwin", "flach", "flashe", "flash mcwin", "voiture rouge"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  },
  {
    question: "üêò Je suis un √©l√©phant volant avec de grandes oreilles.",
    answer: "dumbo",
    synonyms: ["dumbo", "dumboo", "dumboo", "dambot", "dumbo l'√©l√©phant", "l'√©l√©phant", "√©l√©phant volant", "√©l√©fan"],
    image: "https://cdn.pixabay.com/photo/2021/06/06/06/24/lock-6314371_1280.png"
  }
]
];
let steps2Selected = [], current2 = 0, lives2 = 3, time2 = 600, timer2;

function startGameDisney() {
  document.getElementById("introDisney").classList.remove("active");
  document.getElementById("gameDisney").classList.add("active");
  enableGyroscopeTorch();
  document.getElementById("bgMusic").volume = 0.3;
  current2 = 0; lives2 = 3; time2 = 600;
  document.getElementById("livesDisney").textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
  steps2Selected = pickRandomItems(steps2, 3);
  showStep2();
  timer2 = setInterval(() => {
    time2--;
    if (time2 <= 0) endGame2(false, "‚õî Temps √©coul√© !");
    else {
      const m = Math.floor(time2 / 60), s = time2 % 60;
      document.getElementById("timerDisney").textContent = `‚è±Ô∏è Temps restant : ${m}:${s < 10 ? '0' : ''}${s}`;
    }
  }, 1000);
}
function showStep2() {
  document.getElementById("stepTextDisney").textContent = steps2Selected[current2].question;
  document.getElementById("stepImageDisney").src = steps2Selected[current2].image;
  document.getElementById("answerInputDisney").value = '';
  document.getElementById("keyImageDisney").classList.remove("show");
  document.getElementById("messageDisney").textContent = '';
}
function checkAnswerDisney() {
  const input = normalize(document.getElementById("answerInputDisney").value);
  const valid = [steps2Selected[current2].answer, ...steps2Selected[current2].synonyms].some(a => input.includes(normalize(a)));
  if (valid) {
    successSound.play();
    document.getElementById("keyImageDisney").classList.add("show");
    setTimeout(() => {
      current2++;
      current2 < steps2Selected.length ? showStep2() : endGame2(true);
    }, 1500);
  } else {
    errorSound.play();
    lives2--;
    document.getElementById("livesDisney").textContent = "‚ù§Ô∏è".repeat(lives2) + "üñ§".repeat(3 - lives2);
    document.getElementById("messageDisney").textContent = "‚ùå Mauvaise r√©ponse.";
    if (lives2 <= 0) endGame2(false, "üíÄ Tu as perdu !");
  }
}
function endGame2(success, msg = "") {
  clearInterval(timer2);
  document.getElementById("stepTextDisney").textContent = success ? "üéâ Bravo !" : msg;
  document.getElementById("answerInputDisney").style.display = "none";
  document.getElementById("validateBtnDisney").style.display = "none";
  document.getElementById("livesDisney").textContent = "";
  const btn = document.createElement("button");
  btn.textContent = "üîÅ Rejouer";
  btn.onclick = () => location.reload();
  document.getElementById("gameDisney").appendChild(btn);
}
</script>
</body>
</html>
